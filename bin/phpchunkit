#!/usr/bin/env php
<?php

use PHPChunkit\Configuration;
use PHPChunkit\TesterApplication;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Output\ConsoleOutput;

if (file_exists($autoloadPath = __DIR__.'/../vendor/autoload.php')) {
    require_once __DIR__.'/../vendor/autoload.php';
} else {
    require_once __DIR__.'/../../../../vendor/autoload.php';
}

$input = new ArgvInput();
$output = new ConsoleOutput();
$app = new Application();

$distXmlPath = __DIR__.'/../phpchunkit.xml.dist';
$xmlPath = __DIR__.'/../phpchunkit.xml';

$xmlPath = file_exists($distXmlPath)
    ? realpath($distXmlPath)
    : realpath($xmlPath)
;

$sandboxEnabled = array_filter($_SERVER['argv'], function ($arg) {
    return strpos($arg, 'sandbox') !== false;
}) ? true : false;

$configuration = Configuration::createFromXmlFile($xmlPath);
$configuration->setSandboxEnabled($sandboxEnabled);

$testerApplication = new TesterApplication($app, $configuration);
$testerApplication->run($input, $output);
